<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Localizador To Moko</title>
    
    <!-- ENLACE A MANIFEST.JSON para modo standalone (PWA) -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Carga de Tailwind CSS para un dise√±o moderno y m√≥vil-friendly -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos personalizados para la est√©tica */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Fondo oscuro */
        }
        .card {
            background-color: #161b22; /* Fondo de tarjeta m√°s claro */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .result-label {
            color: #8b949e;
        }
        .result-value {
            color: #c9d1d9;
            word-break: break-all;
        }
    </style>
</head>
<body class="p-4 flex items-center justify-center min-h-screen">

    <div id="app" class="card p-6 md:p-8 w-full max-w-sm mx-auto rounded-xl border border-gray-700">
        <h1 class="text-2xl font-bold text-white mb-4 text-center">Localizador To Moko</h1>
        <p class="text-sm text-gray-400 mb-6 text-center">Captura los simbolos Maor√≠ escondidos</p>

        <!-- Bot√≥n de Acci√≥n -->
        <button id="get-location-btn" 
                class="w-full py-3 px-4 mb-6 rounded-lg font-semibold transition duration-200 
                       bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-500/50 
                       focus:outline-none focus:ring-4 focus:ring-blue-500/50 active:scale-95">
            Buscar
        </button>

        <!-- Indicador de Carga/Mensajes -->
        <div id="message" class="text-center text-sm mb-4 text-yellow-400 hidden">
            <!-- SVG de carga (Spinning loader) -->
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-yellow-400 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Buscando To Moko...
        </div>

        <!-- Alerta de Coincidencia (Nueva Secci√≥n) -->
        <div id="match-alert" class="mt-6 p-4 bg-green-900/50 text-green-300 border border-green-700 rounded-xl text-center hidden">
            <div class="text-3xl mb-2">üéâ</div>
            <p class="font-bold text-lg">¬°Has capturado un Moko!</p>
            <p class="text-sm text-green-200 mt-1">Est√°s muy cerca de </p>
            <p id="matched-station-name" class="font-bold text-lg"></p>
            <img id="matched-station-img" src="">
            <p id="matched-station-description" class="text-sm text-green-200 mt-1 text-justify"></p>
        </div>


        <!-- Resultados de Ubicaci√≥n Actual -->
        <div id="results-container" class="space-y-3 p-4 bg-gray-800 rounded-lg hidden">
            <h2 class="text-lg font-semibold text-green-400 mb-3 border-b border-gray-700 pb-2">Tu Ubicaci√≥n Actual</h2>
            
            <div class="flex flex-col">
                <span class="result-label text-xs">Latitud:</span>
                <span id="latitude" class="result-value font-mono">--</span>
            </div>
            
            <div class="flex flex-col">
                <span class="result-label text-xs">Longitud:</span>
                <span id="longitude" class="result-value font-mono">--</span>
            </div>
        </div>
        
        <!-- RESULTADOS DE DISTANCIA A PUNTOS FIJOS -->
        <div id="distance-results-container" class="mt-6 p-4 bg-gray-800 rounded-lg hidden">
            <h2 class="text-lg font-semibold text-blue-400 mb-3 border-b border-gray-700 pb-2">Otros s√≠mbolos cercanos</h2>
            <div id="distance-list" class="space-y-2">
                <!-- Los resultados se inyectar√°n aqu√≠ -->
            </div>
        </div>

        <!-- Contenedor para Errores -->
        <div id="error-box" class="p-3 mt-6 bg-red-800/30 text-red-400 rounded-lg hidden">
            <span class="font-bold">Error de GPS:</span> <span id="error-message"></span>
        </div>

        <!-- Sugerencia de instalaci√≥n para m√≥vil -->
        <div class="mt-6 p-3 text-center bg-gray-800/50 text-gray-400 text-xs rounded-lg border border-gray-700">
            <p>Modo PWA: se abre en ventana propia gracias al manifest.json.</p>
        </div>
    </div>

    <script>
        const btn = document.getElementById('get-location-btn');
        const message = document.getElementById('message');
        const resultsContainer = document.getElementById('results-container');
        const distanceContainer = document.getElementById('distance-results-container');
        const distanceList = document.getElementById('distance-list');
        const errorBox = document.getElementById('error-box');
        const errorMessage = document.getElementById('error-message');
        const matchAlert = document.getElementById('match-alert'); // NUEVO
        const matchedNameDisplay = document.getElementById('matched-station-name'); // NUEVO
        const imgItem = document.getElementById('matched-station-img'); // NUEVO
        const descriptionItem = document.getElementById('matched-station-description'); // NUEVO

        // Referencias a los campos de resultado de ubicaci√≥n actual
        const latDisplay = document.getElementById('latitude');
        const lonDisplay = document.getElementById('longitude');
        


        // =======================================================
        // 2. FUNCI√ìN DE C√ÅLCULO DE DISTANCIA (F√≥rmula de Haversine)
        // =======================================================
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radio de la Tierra en kil√≥metros
            const toRad = (degrees) => degrees * (Math.PI / 180);

            const dLat = toRad(lat2 - lat1);
            const dLon = toRad(lon2 - lon1);

            const a = 
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);

            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // Distancia en km
        }

        /**
         * Funci√≥n que se ejecuta cuando se obtiene la ubicaci√≥n con √©xito.
         * @param {GeolocationPosition} position - Objeto con los datos de la posici√≥n.
         */
        function success() {
     
            // Detener la carga y ocultar errores
            message.classList.add('hidden');
            btn.disabled = false;
            btn.textContent = 'Buscar de nuevo';
            errorBox.classList.add('hidden');

            //const currentLat = -37;
            //const currentLon = 174.8;
            const currentLat = position.coords.latitude;
            const currentLon = position.coords.longitude;
            let matchFound = false;
            let matchedStationName = '';

            
            // 1. Mostrar ubicaci√≥n actual
            latDisplay.textContent = currentLat.toFixed(6);
            lonDisplay.textContent = currentLon.toFixed(6);
            resultsContainer.classList.remove('hidden');

            // 2. Limpiar e inyectar resultados de distancia
            distanceList.innerHTML = '';
            
            STATIONS.forEach(station => {
                const distanceKm = calculateDistance(currentLat, currentLon, station.lat, station.lon);

                // --- L√ìGICA DE COINCIDENCIA (NUEVO) ---
                // Si la distancia es menor a 50 metros (0.05 km), se considera una coincidencia.
                if (distanceKm < 15) { 
                    matchFound = true;
                    matchedStationName = station.name;
                    matchedStationImg = station.img;
                    matchedStationDescription = station.description;
                }
                // -------------------------------------
                
                // Redondea a 2 decimales para mostrar
                const formattedDistance = distanceKm.toFixed(2); 
                station.distance = formattedDistance ;
                // Crea el elemento de la lista
                //const listItem = document.createElement('div');
                //listItem.className = 'flex justify-between items-center py-2 border-b border-gray-700 last:border-b-0';
                //listItem.innerHTML = `
                //    <span class="text-gray-300 font-medium">${station.name}:</span>
                //    <span class="text-lg font-bold ${matchFound && matchedStationName === station.name ? 'text-green-300' : 'text-blue-300'}">${formattedDistance} km</span>
                //`;
                //distanceList.appendChild(listItem);
       
            });
            // PONER EN ORDER ASCENDENTE DE DISTANCIA 
            tempStation = {name: "", img:"", description: "", lat: -45.9003812, lon: 168.2480360};
            for(var g=0; g<STATIONS.length; g++){
                for(var f=g; f<STATIONS.length; f++){ 
                    if (STATIONS[g].distance < STATIONS[f].distance){
                        tempStation = STATIONS[g];
                        STATIONS[g] = STATIONS[f];
                        STATIONS[f] = tempStation;
                    };
                };
            };
            // PUBLICAR SOLO LAS 3 MAS CERCANAS
            for(var g=0; g<3; g++){
                const listItem = document.createElement('div');
                listItem.className = 'flex justify-between items-center py-2 border-b border-gray-700 last:border-b-0';
                listItem.innerHTML = `
                    <span class="text-gray-300 font-medium">üèÜ${STATIONS[g].name}:</span>
                    <span class="text-lg font-bold ${matchFound && matchedStationName === STATIONS[g].name ? 'text-green-300' : 'text-blue-300'}">${STATIONS[g].distance} km</span>
                `;
                distanceList.appendChild(listItem);
            };

            // 3. Mostrar la alerta de coincidencia si se encuentra una
            if (matchFound) {
                matchedNameDisplay.textContent =`${matchedStationName}`;
                imgItem.src = matchedStationImg ;
                descriptionItem.textContent = matchedStationDescription ;
                matchAlert.classList.remove('hidden');
            } else {
                matchAlert.classList.add('hidden');
            }
            
            distanceContainer.classList.remove('hidden');

            // Opcional: Centrar la vista en el contenedor de resultados si est√° en m√≥vil
            //distanceContainer.scrollIntoView({ behavior: 'smooth' });
            matchAlert.scrollIntoView({ behavior: 'smooth' });
        }

        /**
         * Funci√≥n que se ejecuta si hay un error al obtener la ubicaci√≥n.
         * @param {GeolocationPositionError} err - Objeto de error.
         */
        function error(err) {
            // Detener la carga y mostrar el error
            message.classList.add('hidden');
            btn.disabled = false;
            btn.textContent = 'Obtener Coordenadas y Distancias';
            resultsContainer.classList.add('hidden');
            distanceContainer.classList.add('hidden');
            matchAlert.classList.add('hidden'); // Ocultar coincidencia en caso de error

            let msg = '';
            switch (err.code) {
                case err.PERMISSION_DENIED:
                    msg = "Permiso denegado: Necesitas permitir el acceso a la ubicaci√≥n. Aseg√∫rate de estar en un entorno HTTPS si no es localhost.";
                    break;
                case err.POSITION_UNAVAILABLE:
                    msg = "Posici√≥n no disponible: No se puede determinar la ubicaci√≥n.";
                    break;
                case err.TIMEOUT:
                    msg = "Tiempo de espera agotado: El intento de obtener la ubicaci√≥n ha tardado demasiado.";
                    break;
                default:
                    msg = "Error desconocido (" + err.code + ").";
            }

            errorMessage.textContent = msg;
            errorBox.classList.remove('hidden');
            console.error('Error de Geolocation:', err.message);
        }

        /**
         * Funci√≥n principal para solicitar la ubicaci√≥n.
         */
        function getLocation() {
            if (!navigator.geolocation) {
                // Si el navegador no soporta Geolocation
                errorMessage.textContent = "Tu navegador no soporta la API de Geolocation.";
                errorBox.classList.remove('hidden');
                return;
            }

            // Ocultar resultados y errores previos
            resultsContainer.classList.add('hidden');
            distanceContainer.classList.add('hidden');
            errorBox.classList.add('hidden');
            matchAlert.classList.add('hidden'); // Siempre ocultar al inicio
            
            // Mostrar estado de carga y deshabilitar bot√≥n
            message.classList.remove('hidden');
            btn.disabled = true;
            btn.textContent = 'Buscando...';

            // Opciones de Geolocation: alta precisi√≥n y tiempo m√°ximo de espera de 10 segundos
            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0 // No usar cach√©
            };

            // Llamada a la API de Geolocation
           navigator.geolocation.getCurrentPosition(success, error, options);
            //success();
        }

        // Asignar el evento click al bot√≥n
        btn.addEventListener('click', getLocation);

        // =======================================================
        // 1. COORDENADAS ALMACENADAS PARA LA COMPARACI√ìN
        // Puedes cambiar estas coordenadas por las que necesites.
        // =======================================================
        const STATIONS = [
{ name: "Urutengangana", img:"img/Urutengangana.jpg", description: `Urutengangana is the MƒÅori god of light. He is the eldest of the
children of Ranginui the Sky Father and Papat≈´ƒÅnuku the Earth
Mother. His children were the gods of the stars and the moon.`, lat: -41.1680009, lon: 174.0608852 },

{ name: "Tumatauenga", img:"img/Tumatauenga.jpg", description: `
T≈´ or Tumatauenga is the MƒÅori god of war, hunting, food cultivation,
fishing and cooking. The MƒÅori would dedicate hunting trips and war-
parties to T≈´matauenga.`, lat: -39.3524332, lon: 174.2214992},

{ name: "R≈´aumoko", img:"img/ruaumoko.jpg", description: `
R≈´aumoko is the god of earthquakes, volcanoes and seasons. He is
the youngest son of Ranginui the Sky Father and Papat≈´ƒÅnuku the
Earth Mother. Although thought to be a kind god, R≈´aumoko (like
earthquakes and volcanoes) also represents danger and destruction.`, lat: -42.1119642, lon: 172.6010590},


{ name: "Rongo", img:"img/rongo.jpg", description: `
In MƒÅori mythology, Rongo or Rongo-mƒÅ-TƒÅne is the god of cultivated
plants, or agriculture, especially the production of k≈´mara (yams).
The MƒÅori relied heavily on their harvests, and would offer the first
kumara of the season to Rongo.`, lat: -42.9150553, lon: 171.9547704},

{ name: "Mangopare", img:"img/Mangopare.jpg", description: `
The Mangopare symbol depicts the hammerhead shark. It
symbolizes strength, termination, strong will and fighting spirit. MƒÅori
believed sharks to be protective spirits, and shark teeth necklaces
were common status symbols amongst tribe leaders.`, lat: -43.0951999, lon: 171.6749412 },

{ name: "Moana", img:"img/Moana.jpg", description: `
Moana means an open body of water ‚Äì an ocean or sea. The term
Moana, meaning ocean, is common to all Polynesian cultures. To the
MƒÅori, the sea was the source of all life, and the sea was relied on for
sustenance, through fishing. The sea can be calm, energetic or
dangerous at different times. These qualities are reflected in the
meaning of the Moana symbol.`, lat: -44.2120705, lon: 170.3153667 },


{ name: "Koru Aihe", img:"img/KoruAihe.jpg", description: `
The Koru Aihe inspired by dolphins symbolizes playfulness, harmony
and friendship. MƒÅori revered dolphins, as they did whales, believing
them to be water spirits. Legendary tales tell of sailors being guided
through treacherous waterways by gods who had taken the form of
dolphins.`, lat: -45.0665814, lon: 169.3391402 },
        
{ name: "Koru Honu", img:"img/KoruHonu.jpg", description: `
The Koru Honu depicts a sea turtle in the act of swimming. Turtles
symbolize travel and navigation in MƒÅori culture. Additional meanings
include fertility, longevity, peacefulness and unity.`, lat: -45.9003812, lon: 168.2480360},

{ name: "Wera", img:"img/Wera.jpg", description: `
The Wera symbol represents the tail of a whale. Whales were tapu
(sacred) to the MƒÅori. They were thought to be descended from the
god of the ocean and were therefore supernatural in nature. The
Wera symbolizes the ocean and a guardian spirit, especially for those
at sea.`, lat: -46.2879781, lon: 167.9119636},

{ name: "Toki Adze", img:"img/TokiAdze.jpg", description: `
The Toki Adze is a ceremonial chisel used by the MƒÅori for occasions
such as the felling of a tree in order to carve a canoe, or to produce
carved symbols to adorn buildings and structures that are important
to the tribe. As a symbol, the Toki represents strength and authority.`, lat: -41.1969129, lon: 174.9736962 },

{ name: "pekapeka", img:"img/pekapekamaori.jpg", description: `
Pekapeka is the MƒÅori word for bat. Bats are the only land mammal
native to New Zealand. The MƒÅori would hunt by kindling a fire in the
hollow of a tree, catching the bats in the air as they tried to escape
`, lat: -37.0661338, lon: 174.8635439 },

{ name: "Hei Taiaha", img:"img/heiTaiaha.jpg", description: `
A Taiaha is a traditional MƒÅori weapon. It is a short fighting staff
weapon made for close-quarters combat. Carved from either wood
or whalebone, these weapons represent treasured items. The Hei
Taiaha symbolizes the MƒÅori warrior culture.`, lat: -43.6026796, lon: 172.5781912},

{ name: "Hei Tiki", img:"img/HeiTiki.jpg", description: `
The Hei Tiki is commonly regarded as a symbol of good luck and of
fertility, representing the unborn human embryo. Hei Tiki is thought to
be a representation of the first man. The MƒÅori believe the wearer of
a tiki talisman to be clear thinking, perceptive, loyal and
knowledgeable.`, lat: -38.0939447, lon: 176.1518002 },

{ name: "Manaia", img:"img/Manaia.jpg", description: `
The Manaia symbol represents a mythological spiritual guardian, or
messenger. It is traditionally depicted with the head of a bird, body of
a man and the tail of a fish. The Manaia guards against evil and
guides the spirit.`, lat: -39.3582506, lon: 175.8262772 },

{ name: "Pikorua Double Twist", img:"img/Pikorua.jpg", description: `
The Pikorua double twist represents the joining together of two
people, or two cultures for eternity. Although they may experience
ups and downs, they will remain bonded by friendship and loyalty for
life.`, lat: -38.3720292, lon: 175.1396016 },

{ name: "Pikorua Single Twist ", img:"img/Pikorua1.jpg", description: `
The Pikorua single twist represents the path of life, it is the symbol of
eternity. It represents the joining together of two people. The
meaning of the Pikorua single twist is different from the double twist
Pikorua`, lat: -42.0759953, lon: 172.8207128 },

{ name: "Hei Matau", img:"img/HeiMatau.jpg", description: `
The Hei Matau, or the fish hook, symbolizes prosperity. In their quiet
corner of the South Pacific, fish stocks were plentiful, and the MƒÅori
knew that a man (or woman) who had the means to catch fish would
prosper. The Hei Matau also represents strength, determination
(required for good fishing), good health (acquired by good eating),
and providing a safe journey over water.`, lat: -39.4759475, lon: 175.4573666 },

{ name: "Koru", img:"img/Koru.jpg", description: `
The Koru motif is the cornerstone of much MƒÅori art. It is not
considered tapu (sacred) in and of itself, but recurs in sacred
designs. It represents the young frond of the silver fern, which is
native only to New Zealand. As such, in recent years the symbol has
come to be used to represent New Zealand in many ways, not only
MƒÅori culture. The Koru symbolizes life, growth, strength and peace.
Its shape conveys ideas of movement, latent and potential energy,
creation and renewal, light and enlightenment.`, lat: -38.8155306, lon: 175.7608625 }
        ];
    </script>
</body>
</html>